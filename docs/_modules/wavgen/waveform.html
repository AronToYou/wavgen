<!DOCTYPE html>




<html lang="en">
  <head>
    <meta charset="utf-8" />
    
    <title>wavgen.waveform &mdash; wavgen 1.5.3 documentation</title>
    <meta name="description" content="">
    <meta name="author" content="">

    

<link rel="stylesheet" href="../../_static/css/basicstrap-base.css" type="text/css" />
<link rel="stylesheet" id="current-theme" href="../../_static/css/bootstrap3/bootswatch-darkly.css" type="text/css" />
<link rel="stylesheet" id="current-adjust-theme" href="../../_static/css/adjust_theme/bootswatch-darkly.css" type="text/css" />

<link rel="stylesheet" href="../../_static/css/font-awesome.min.css">

<style type="text/css">
  body {
    padding-top: 60px;
    padding-bottom: 40px;
  }
</style>

<link rel="stylesheet" href="../../_static/css/basicstrap.css" type="text/css" />
<link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
<script type="text/javascript">
  var DOCUMENTATION_OPTIONS = {
            URL_ROOT:    '../../',
            VERSION:     '1.5.3',
            COLLAPSE_INDEX: false,
            FILE_SUFFIX: '.html',
            HAS_SOURCE:  true
  };
</script>
    <script type="text/javascript" src="../../_static/js/jquery.min.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../_static/js/bootstrap3.min.js"></script>
<script type="text/javascript" src="../../_static/js/jquery.cookie.min.js"></script>
<script type="text/javascript" src="../../_static/js/basicstrap.js"></script>
<script type="text/javascript">
</script>
    <link rel="shortcut icon" href="../../_static/logo.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="top" title="wavgen 1.5.3 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body role="document">
    <div id="navbar-top" class="navbar navbar-fixed-top navbar-inverse" role="navigation" aria-label="top navigation">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../../index.html">wavgen 1.5.3 documentation</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">

            
              <li><a href="../../py-modindex.html" title="Python Module Index" >modules </a></li>
              <li><a href="../../genindex.html" title="General Index" accesskey="I">index </a></li>
              <li><a href="../index.html" accesskey="U">Module code</a></li>
            

            <li class="visible-xs">
                <form class="search form-search form-inline navbar-form navbar-right sp-searchbox" action="../../search.html" method="get">
                  <div class="input-append input-group">
                    <input type="text" class="search-query form-control" name="q" placeholder="Search...">
                    <span class="input-group-btn">
                    <input type="submit" class="btn" value="Go" />
                    </span>
                  </div>
                  <input type="hidden" name="check_keywords" value="yes" />
                  <input type="hidden" name="area" value="default" />
                </form>
            </li>

            

          </ul>

        </div>
      </div>
    </div>
    

    <!-- container -->
    <div class="container-fluid">

      <!-- row -->
      <div class="row">
         
<div class="col-md-3 hidden-xs" id="sidebar-wrapper">
  <div class="sidebar hidden-xs" role="navigation" aria-label="main navigation">
    <p class="logo"><a href="../../index.html">
      <img class="logo" src="../../_static/logo.png" alt="Logo"/>
    </a></p>
<div id="searchbox" role="search">
  <h3>Quick search</h3>
  <form class="search form-inline" action="../../search.html" method="get">
      <div class="input-append input-group">
        <input type="text" class="search-query form-control" name="q" placeholder="Search...">
        <span class="input-group-btn">
        <input type="submit" class="btn" value="Go" />
        </span>
      </div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
  </div>
</div> 
        

        <div class="col-md-9" id="content-wrapper">
          <div class="document" role="main">
            <div class="documentwrapper">
              <div class="bodywrapper">
                <div class="body">
                  
  <h1>Source code for wavgen.waveform</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">pi</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cosh</span><span class="p">,</span> <span class="n">log</span>
<span class="kn">from</span> <span class="nn">.waveform_base</span> <span class="kn">import</span> <span class="n">Waveform</span>
<span class="kn">from</span> <span class="nn">.utilities</span> <span class="kn">import</span> <span class="n">Wave</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">maxsize</span>
<span class="kn">from</span> <span class="nn">.config</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">random</span>


<div class="viewcode-block" id="Superposition"><a class="viewcode-back" href="../../docs/waveform.html#wavgen.waveform.Superposition">[docs]</a><span class="k">class</span> <span class="nc">Superposition</span><span class="p">(</span><span class="n">Waveform</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A static trap configuration.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    Waves : list of :class:`~wavgen.utilities.Wave`</span>
<span class="sd">        The list of composing pure tones. Each object holds a frequency,</span>
<span class="sd">        magnitude, and relative phase.</span>

<span class="sd">    Hint</span>
<span class="sd">    ----</span>
<span class="sd">    There are now 3 relevant **amplitudes** here:</span>
<span class="sd">    :meth:`Output Voltage Limit &lt;wavgen.card.Card.setup_channels&gt;`,</span>
<span class="sd">    :attr:`Waveform Amplitude &lt;wavgen.waveform.Waveform.Amplitude&gt;`, &amp; the</span>
<span class="sd">    :attr:`amplitudes of each pure tone &lt;wavgen.utilities.Wave.Magnitude&gt;`</span>
<span class="sd">    composing a superposition. Each one is expressed as a fraction of the previous.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    :func:`even_spacing`</span>
<span class="sd">        An alternative constructor for making :class:`Superposition` objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Superposition.__init__"><a class="viewcode-back" href="../../docs/waveform.html#wavgen.waveform.Superposition.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">mags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">phases</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sample_length</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">16E3</span><span class="p">),</span>
                 <span class="n">resolution</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">milliseconds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">amp</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Provides several options for defining waveform duration.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        freqs : list of int</span>
<span class="sd">            A list of frequency values, from which wave objects are automatically created.</span>
<span class="sd">        mags : list of float, optional</span>
<span class="sd">            Vector representing relative magnitude of each trap, within [0,1] (in order of increasing frequency).</span>
<span class="sd">        phases : list of float, optional</span>
<span class="sd">            Vector representing initial phases of each trap tone, within [0, 2*pi]</span>
<span class="sd">            (in order of increasing frequency).</span>
<span class="sd">        sample_length : int, optional</span>
<span class="sd">            Length of waveform in samples.</span>
<span class="sd">        resolution : int, optional</span>
<span class="sd">            Sets the resolution of the waveform in Hertz. **Overrides sample_length**</span>
<span class="sd">        milliseconds : float, optional</span>
<span class="sd">            Length of waveform in milliseconds. **Overrides sample_length &amp; resolution**</span>
<span class="sd">        amp : float, optional</span>
<span class="sd">            Amplitude of waveform relative to maximum output voltage.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">## Validate &amp; Sort ##</span>
        <span class="n">freqs</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">mags</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freqs</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">phases</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">phases</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freqs</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">milliseconds</span><span class="p">:</span>
            <span class="n">sample_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">SAMP_FREQ</span><span class="o">*</span><span class="n">milliseconds</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">resolution</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">resolution</span> <span class="o">&lt;</span> <span class="n">SAMP_FREQ</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;Invalid Resolution, has to be below Nyquist: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">SAMP_FREQ</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">sample_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">SAMP_FREQ</span> <span class="o">/</span> <span class="n">resolution</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">freqs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">SAMP_FREQ</span><span class="o">/</span><span class="n">sample_length</span><span class="p">,</span> <span class="s2">&quot;Frequency is below resolution. Increase sample length.&quot;</span>
        <span class="k">assert</span> <span class="n">freqs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">SAMP_FREQ</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;Frequency </span><span class="si">%d</span><span class="s2"> must below Nyquist: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">freqs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">SAMP_FREQ</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">mags</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">freqs</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">phases</span><span class="p">),</span> <span class="s2">&quot;Parameter size mismatch!&quot;</span>

        <span class="c1">## Initialize ##</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Waves</span> <span class="o">=</span> <span class="p">[</span><span class="n">Wave</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">mags</span><span class="p">,</span> <span class="n">phases</span><span class="p">)]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">sample_length</span><span class="p">,</span> <span class="n">amp</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">DATA_MAX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SampleLength</span> <span class="o">-</span> <span class="n">p</span><span class="o">*</span><span class="n">DATA_MAX</span><span class="p">)</span>
        <span class="n">waveform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="c1">## For each Pure Tone ##</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Waves</span><span class="p">):</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">Frequency</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">Phase</span>
            <span class="n">mag</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">Magnitude</span>

            <span class="n">fn</span> <span class="o">=</span> <span class="n">f</span> <span class="o">/</span> <span class="n">SAMP_FREQ</span>  <span class="c1"># Cycles/Sample</span>
            <span class="c1">## Compute the Wave ##</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">p</span><span class="o">*</span><span class="n">DATA_MAX</span>
                <span class="n">waveform</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">mag</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">n</span> <span class="o">*</span> <span class="n">fn</span> <span class="o">+</span> <span class="n">phi</span><span class="p">)</span>

        <span class="c1">## Send the results to Parent ##</span>
        <span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">((</span><span class="n">p</span><span class="p">,</span> <span class="n">waveform</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">config_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5py_f</span><span class="p">):</span>
        <span class="c1">## Contents ##</span>
        <span class="n">h5py_f</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;freqs&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">w</span><span class="o">.</span><span class="n">Frequency</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Waves</span><span class="p">]))</span>
        <span class="n">h5py_f</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;mags&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">w</span><span class="o">.</span><span class="n">Magnitude</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Waves</span><span class="p">]))</span>
        <span class="n">h5py_f</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;phases&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">w</span><span class="o">.</span><span class="n">Phase</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Waves</span><span class="p">]))</span>
        <span class="n">h5py_f</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;sample_length&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">SampleLength</span><span class="p">)</span>

        <span class="c1">## Table of Contents ##</span>
        <span class="n">h5py_f</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;keys&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;freqs&#39;</span><span class="p">,</span> <span class="s1">&#39;mags&#39;</span><span class="p">,</span> <span class="s1">&#39;phases&#39;</span><span class="p">,</span> <span class="s1">&#39;sample_length&#39;</span><span class="p">])</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">config_file</span><span class="p">(</span><span class="n">h5py_f</span><span class="p">)</span>

<div class="viewcode-block" id="Superposition.get_magnitudes"><a class="viewcode-back" href="../../docs/waveform.html#wavgen.waveform.Superposition.get_magnitudes">[docs]</a>    <span class="k">def</span> <span class="nf">get_magnitudes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of float</span>
<span class="sd">            Value of :attr:`~wavgen.utilities.Wave.Magnitude` for each pure tone,</span>
<span class="sd">            in order of increasing frequency.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">w</span><span class="o">.</span><span class="n">Magnitude</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Waves</span><span class="p">]</span></div>

<div class="viewcode-block" id="Superposition.set_magnitudes"><a class="viewcode-back" href="../../docs/waveform.html#wavgen.waveform.Superposition.set_magnitudes">[docs]</a>    <span class="k">def</span> <span class="nf">set_magnitudes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mags</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the :attr:`~wavgen.utilities.Wave.Magnitude` of each pure tone.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mags : list of float</span>
<span class="sd">            Each new magnitude, limited to (**[0, 1]**), ordered by ascending frequency).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">w</span><span class="p">,</span> <span class="n">mag</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Waves</span><span class="p">,</span> <span class="n">mags</span><span class="p">):</span>
            <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">mag</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;Invalid magnitude: </span><span class="si">%d</span><span class="s2">, must be within interval [0,1]&quot;</span> <span class="o">%</span> <span class="n">mag</span><span class="p">)</span>
            <span class="n">w</span><span class="o">.</span><span class="n">Magnitude</span> <span class="o">=</span> <span class="n">mag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Latest</span> <span class="o">=</span> <span class="kc">False</span></div>

    <span class="k">def</span> <span class="nf">get_phases</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">w</span><span class="o">.</span><span class="n">Phase</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Waves</span><span class="p">]</span>

<div class="viewcode-block" id="Superposition.set_phases"><a class="viewcode-back" href="../../docs/waveform.html#wavgen.waveform.Superposition.set_phases">[docs]</a>    <span class="k">def</span> <span class="nf">set_phases</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phases</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the relative phase of each pure tone.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        phases : list of float</span>
<span class="sd">            New phases, expressed as (**radians**), ordered by ascending frequency.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">w</span><span class="p">,</span> <span class="n">phase</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Waves</span><span class="p">,</span> <span class="n">phases</span><span class="p">):</span>
            <span class="n">w</span><span class="o">.</span><span class="n">Phase</span> <span class="o">=</span> <span class="n">phase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Latest</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Superposition.randomize"><a class="viewcode-back" href="../../docs/waveform.html#wavgen.waveform.Superposition.randomize">[docs]</a>    <span class="k">def</span> <span class="nf">randomize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Randomizes each pure tone&#39;s phase.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Waves</span><span class="p">:</span>
            <span class="n">w</span><span class="o">.</span><span class="n">Phase</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Latest</span> <span class="o">=</span> <span class="kc">False</span></div></div>


<div class="viewcode-block" id="even_spacing"><a class="viewcode-back" href="../../docs/waveform.html#wavgen.waveform.even_spacing">[docs]</a><span class="k">def</span> <span class="nf">even_spacing</span><span class="p">(</span><span class="n">ntraps</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">spacing</span><span class="p">,</span> <span class="n">mags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">phases</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">amp</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Wrapper function which simplifies defining :class:`~wavgen.waveform.Superposition` objects</span>
<span class="sd">     to describe equally spaced traps.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ntraps : int</span>
<span class="sd">        Number of optical traps.</span>
<span class="sd">    center : int</span>
<span class="sd">        Mean or center frequency of the traps.</span>
<span class="sd">    spacing : int</span>
<span class="sd">        Frequency spacing between traps.</span>
<span class="sd">    mags : list of float, optional</span>
<span class="sd">        Vector representing relative magnitude of each trap, within [0,1]</span>
<span class="sd">        (in order of increasing frequency).</span>
<span class="sd">    phases : list of float, optional</span>
<span class="sd">        Vector representing initial phases of each trap tone, within [0, 2*pi]</span>
<span class="sd">        (in order of increasing frequency).</span>
<span class="sd">    periods : int, optional</span>
<span class="sd">        Number of full periods of the entire waveform to calculate.</span>
<span class="sd">    amp : float, optional</span>
<span class="sd">        Amplitude of waveform relative to maximum output voltage.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    :class:`~wavgen.waveform.Superposition`</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">freqs</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">center</span> <span class="o">+</span> <span class="n">spacing</span><span class="o">*</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="p">(</span><span class="n">ntraps</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ntraps</span><span class="p">)]</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">SAMP_FREQ</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">-</span> <span class="n">ntraps</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">//</span> <span class="n">spacing</span><span class="p">)</span> <span class="o">*</span> <span class="n">periods</span>

    <span class="k">return</span> <span class="n">Superposition</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">mags</span><span class="o">=</span><span class="n">mags</span><span class="p">,</span> <span class="n">phases</span><span class="o">=</span><span class="n">phases</span><span class="p">,</span> <span class="n">sample_length</span><span class="o">=</span><span class="n">N</span><span class="p">,</span> <span class="n">amp</span><span class="o">=</span><span class="n">amp</span><span class="p">)</span></div>


<div class="viewcode-block" id="Sweep"><a class="viewcode-back" href="../../docs/waveform.html#wavgen.waveform.Sweep">[docs]</a><span class="k">class</span> <span class="nc">Sweep</span><span class="p">(</span><span class="n">Waveform</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Describes a waveform which smoothly modulates from one :class:`~wavgen.waveform.Superposition`</span>
<span class="sd">    to another.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    WavesA, WavesB : list of :class:`~wavgen.utilities.Wave`</span>
<span class="sd">        Basically full descriptions of 2 :class:`~wavgen.waveform.Superposition` objects;</span>
<span class="sd">        i.e. 2 lists of pure tones, including each frequency, magnitude, &amp; phase.</span>
<span class="sd">    Damp : float</span>
<span class="sd">        Expresses the *change in* :attr:`~wavgen.waveform.Waveform.Amplitude`</span>
<span class="sd">        as the waveform modulates from initial to final configuration.</span>

<span class="sd">    Warning</span>
<span class="sd">    -------</span>
<span class="sd">    Sometimes, roughly 1 out of 8 times, the calculation of a ``Sweep`` object will silently fail;</span>
<span class="sd">    resulting in correct number of data points, except all 0-valued. To avoid the uncertainty of re-calculation,</span>
<span class="sd">    be sure to save ``Sweep`` objects to named files. Also, check calculations with ``Sweep.plot()``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Sweep.__init__"><a class="viewcode-back" href="../../docs/waveform.html#wavgen.waveform.Sweep.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_a</span><span class="p">,</span> <span class="n">config_b</span><span class="p">,</span> <span class="n">sweep_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sample_length</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">16E6</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot; Allows for defining the duration in terms of milliseconds or samples.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        config_a, config_b : :class:`~wavgen.waveform.Superposition`</span>
<span class="sd">            These play the initial &amp; final configurations of the Sweep form,</span>
<span class="sd">            going from **A** to **B** respectively.</span>
<span class="sd">        sweep_time : float, optional</span>
<span class="sd">            The time, in milliseconds, that the waveform will spend to complete</span>
<span class="sd">            the entire modulation. **Overrides sample_length**</span>
<span class="sd">        sample_length : int, optional</span>
<span class="sd">            Otherwise, one can simply fix the length to an integer number of samples.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config_a</span><span class="p">,</span> <span class="n">Superposition</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config_b</span><span class="p">,</span> <span class="n">Superposition</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">config_a</span><span class="o">.</span><span class="n">Waves</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">config_b</span><span class="o">.</span><span class="n">Waves</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sweep_time</span><span class="p">:</span>
            <span class="n">sample_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">SAMP_FREQ</span><span class="o">*</span><span class="n">sweep_time</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">WavesA</span> <span class="o">=</span> <span class="n">config_a</span><span class="o">.</span><span class="n">Waves</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">WavesB</span> <span class="o">=</span> <span class="n">config_b</span><span class="o">.</span><span class="n">Waves</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Damp</span> <span class="o">=</span> <span class="p">(</span><span class="n">config_b</span><span class="o">.</span><span class="n">Amplitude</span> <span class="o">/</span> <span class="n">config_a</span><span class="o">.</span><span class="n">Amplitude</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">sample_length</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">sample_length</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">config_a</span><span class="o">.</span><span class="n">Amplitude</span><span class="p">,</span> <span class="n">config_b</span><span class="o">.</span><span class="n">Amplitude</span><span class="p">))</span></div>

    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">DATA_MAX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SampleLength</span> <span class="o">-</span> <span class="n">p</span><span class="o">*</span><span class="n">DATA_MAX</span><span class="p">)</span>
        <span class="n">waveform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="c1">## For each Pure Tone ##</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">WavesA</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">WavesB</span><span class="p">)):</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">Frequency</span> <span class="o">/</span> <span class="n">SAMP_FREQ</span>  <span class="c1"># Cycles/Sample</span>
            <span class="n">dfn_inc</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">Frequency</span> <span class="o">-</span> <span class="n">a</span><span class="o">.</span><span class="n">Frequency</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">SAMP_FREQ</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">SampleLength</span><span class="p">)</span>

            <span class="n">phi</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">Phase</span>
            <span class="n">phi_inc</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">Phase</span> <span class="o">-</span> <span class="n">phi</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">SampleLength</span>

            <span class="n">mag</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">Magnitude</span>
            <span class="n">mag_inc</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">Magnitude</span> <span class="o">-</span> <span class="n">mag</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">SampleLength</span>

            <span class="c1">## Compute the Wave ##</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">p</span><span class="o">*</span><span class="n">DATA_MAX</span>
                <span class="n">dfn</span> <span class="o">=</span> <span class="n">dfn_inc</span> <span class="o">*</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># Sweep Frequency shift</span>
                <span class="n">waveform</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">n</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Damp</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">mag</span> <span class="o">+</span> <span class="n">n</span><span class="o">*</span><span class="n">mag_inc</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">fn</span> <span class="o">+</span> <span class="n">dfn</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">phi</span> <span class="o">+</span> <span class="n">n</span><span class="o">*</span><span class="n">phi_inc</span><span class="p">))</span>

        <span class="c1">## Send the results to Parent ##</span>
        <span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">((</span><span class="n">p</span><span class="p">,</span> <span class="n">waveform</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">config_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5py_f</span><span class="p">):</span>
        <span class="c1">## Contents ##</span>
        <span class="n">h5py_f</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;freqsA&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">w</span><span class="o">.</span><span class="n">Frequency</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">WavesA</span><span class="p">]))</span>
        <span class="n">h5py_f</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;magsA&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">w</span><span class="o">.</span><span class="n">Magnitude</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">WavesA</span><span class="p">]))</span>
        <span class="n">h5py_f</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;phasesA&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">w</span><span class="o">.</span><span class="n">Phase</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">WavesA</span><span class="p">]))</span>

        <span class="n">h5py_f</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;freqsB&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">w</span><span class="o">.</span><span class="n">Frequency</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">WavesB</span><span class="p">]))</span>
        <span class="n">h5py_f</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;magsB&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">w</span><span class="o">.</span><span class="n">Magnitude</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">WavesB</span><span class="p">]))</span>
        <span class="n">h5py_f</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;phasesB&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">w</span><span class="o">.</span><span class="n">Phase</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">WavesB</span><span class="p">]))</span>

        <span class="n">h5py_f</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;sample_length&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">SampleLength</span><span class="p">)</span>

        <span class="c1">## Table of Contents ##</span>
        <span class="n">h5py_f</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;keys&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;freqsA&#39;</span><span class="p">,</span> <span class="s1">&#39;magsA&#39;</span><span class="p">,</span> <span class="s1">&#39;phasesA&#39;</span><span class="p">,</span> <span class="s1">&#39;freqsB&#39;</span><span class="p">,</span> <span class="s1">&#39;magsB&#39;</span><span class="p">,</span> <span class="s1">&#39;phasesB&#39;</span><span class="p">,</span> <span class="s1">&#39;sample_length&#39;</span><span class="p">])</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">config_file</span><span class="p">(</span><span class="n">h5py_f</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">freqsA</span><span class="p">,</span> <span class="n">magsA</span><span class="p">,</span> <span class="n">phasesA</span><span class="p">,</span> <span class="n">freqsB</span><span class="p">,</span> <span class="n">magsB</span><span class="p">,</span> <span class="n">phasesB</span><span class="p">,</span> <span class="n">sample_length</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="n">supA</span> <span class="o">=</span> <span class="n">Superposition</span><span class="p">(</span><span class="n">freqsA</span><span class="p">,</span> <span class="n">magsA</span><span class="p">,</span> <span class="n">phasesA</span><span class="p">)</span>
        <span class="n">supB</span> <span class="o">=</span> <span class="n">Superposition</span><span class="p">(</span><span class="n">freqsB</span><span class="p">,</span> <span class="n">magsB</span><span class="p">,</span> <span class="n">phasesB</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">supA</span><span class="p">,</span> <span class="n">supB</span><span class="p">,</span> <span class="n">sample_length</span><span class="o">=</span><span class="n">sample_length</span><span class="p">)</span></div>


<span class="c1">######### HS1 Class #########</span>
<div class="viewcode-block" id="HS1"><a class="viewcode-back" href="../../docs/waveform.html#wavgen.waveform.HS1">[docs]</a><span class="k">class</span> <span class="nc">HS1</span><span class="p">(</span><span class="n">Waveform</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Embodies a Hyperbolic-Secant Pulse.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    Tau : float</span>
<span class="sd">        Characteristic length of pulse; expressed in samples.</span>
<span class="sd">    Center : float</span>
<span class="sd">        The frequency at which the sweep is centered about; expressed as oscillations per sample.</span>
<span class="sd">    BW : float</span>
<span class="sd">        Bandwith or width of the range the frequency is swooped across; expressed as oscillations per sample.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    `B Peaudecerf et al 2019 New J. Phys. 21 013020 (Section 3.1) &lt;file:../_static/pap1.pdf&gt;`_</span>
<span class="sd">        Relevant context. Used to verify functional form.</span>

<span class="sd">    `M. Khudaverdyan et al 2005 Phys. Rev. A 71, 031404(R) &lt;file:../_static/pap2.pdf&gt;`_</span>
<span class="sd">        Slightly more relevant...yet less useful.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="HS1.__init__"><a class="viewcode-back" href="../../docs/waveform.html#wavgen.waveform.HS1.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pulse_time</span><span class="p">,</span> <span class="n">center_freq</span><span class="p">,</span> <span class="n">sweep_width</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">amp</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pulse_time : float</span>
<span class="sd">            Sets the characteristic time.</span>
<span class="sd">        center_freq : int</span>
<span class="sd">            The frequency sweep is centered about this value.</span>
<span class="sd">        sweep_width : int</span>
<span class="sd">            How wide, in frequency, the sweep swoops.</span>
<span class="sd">        duration : float, optional</span>
<span class="sd">            Used to fix the waveform duration, while the pulse width itself is unaffected.</span>
<span class="sd">            Otherwise, we follow a recommendation from the first reference above.</span>
<span class="sd">        amp : float, optional</span>
<span class="sd">            Amplitude of waveform relative to maximum output voltage.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">duration</span><span class="p">:</span>
            <span class="n">sample_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">SAMP_FREQ</span> <span class="o">*</span> <span class="n">duration</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sample_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">SAMP_FREQ</span> <span class="o">*</span> <span class="n">pulse_time</span> <span class="o">*</span> <span class="mi">5</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">sample_length</span><span class="p">,</span> <span class="n">amp</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Tau</span> <span class="o">=</span> <span class="n">pulse_time</span> <span class="o">*</span> <span class="n">SAMP_FREQ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Center</span> <span class="o">=</span> <span class="n">center_freq</span> <span class="o">/</span> <span class="n">SAMP_FREQ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BW</span> <span class="o">=</span> <span class="n">sweep_width</span> <span class="o">/</span> <span class="n">SAMP_FREQ</span></div>

    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">DATA_MAX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SampleLength</span> <span class="o">-</span> <span class="n">p</span><span class="o">*</span><span class="n">DATA_MAX</span><span class="p">)</span>
        <span class="n">waveform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="c1">## Compute the Wave ##</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">p</span><span class="o">*</span><span class="n">DATA_MAX</span>

            <span class="n">d</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">SampleLength</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Tau</span>  <span class="c1"># 2(t - T/2)/tau</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">arg</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Center</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Tau</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">BW</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">cosh</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
                <span class="n">amp</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">cosh</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">OverflowError</span><span class="p">:</span>
                <span class="n">arg</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Center</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Tau</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">BW</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">maxsize</span><span class="p">)</span>
                <span class="n">amp</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="n">waveform</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">arg</span><span class="p">)</span>

        <span class="c1">## Send results to Parent ##</span>
        <span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">((</span><span class="n">p</span><span class="p">,</span> <span class="n">waveform</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">config_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5py_f</span><span class="p">):</span>
        <span class="c1">## Contents ##</span>
        <span class="n">h5py_f</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;pulse_time&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Tau</span> <span class="o">/</span> <span class="n">SAMP_FREQ</span><span class="p">)</span>
        <span class="n">h5py_f</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;center_freq&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Center</span> <span class="o">*</span> <span class="n">SAMP_FREQ</span><span class="p">)</span>
        <span class="n">h5py_f</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;sweep_width&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">BW</span> <span class="o">*</span> <span class="n">SAMP_FREQ</span><span class="p">)</span>
        <span class="n">h5py_f</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;duration&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">SampleLength</span> <span class="o">/</span> <span class="n">SAMP_FREQ</span><span class="p">)</span>

        <span class="c1">## Table of Contents ##</span>
        <span class="n">h5py_f</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;keys&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;pulse_time&#39;</span><span class="p">,</span> <span class="s1">&#39;center_freq&#39;</span><span class="p">,</span> <span class="s1">&#39;sweep_width&#39;</span><span class="p">,</span> <span class="s1">&#39;duration&#39;</span><span class="p">])</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">config_file</span><span class="p">(</span><span class="n">h5py_f</span><span class="p">)</span></div>
</pre></div>

                </div>
              </div>
            </div>
          </div>
        </div>
        
        
      </div><!-- /row -->

      <!-- row -->
      <div class="row footer-relbar">
<div id="navbar-related" class=" related navbar navbar-inverse" role="navigation" aria-label="related navigation">
  <div class="navbar-inner">
    <ul class="nav navbar-nav ">
        <li><a href="../../index.html">wavgen 1.5.3 documentation</a></li>
    </ul>
<ul class="nav navbar-nav pull-right hidden-xs hidden-sm">
      
        <li><a href="../../py-modindex.html" title="Python Module Index" >modules</a></li>
        <li><a href="../../genindex.html" title="General Index" >index</a></li>
        <li><a href="../index.html" >Module code</a></li>
        <li><a href="#">top</a></li> 
      
    </ul>
  </div>
</div>
      </div><!-- /row -->

      <!-- footer -->
      <footer role="contentinfo">
          &copy; Copyright 2020, Aron Lloyd.
        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 3.0.0.
      </footer>
      <!-- /footer -->

    </div>
    <!-- /container -->

  </body>
</html>